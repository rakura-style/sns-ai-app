rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザーは自分のデータのみアクセス可能
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // （将来サブコレクションに切り出す場合の例）
      // X API認証情報は書き込みのみ（読み取りはサーバー側で行う）
      match /xCredentials/{credentialId} {
        allow write: if request.auth != null && request.auth.uid == userId;
        allow read: if false; // クライアント側からの直接読み取りを禁止
      }
    }

    // artifactsコレクション（利用回数管理用）
    match /artifacts/{appId}/users/{userId}/daily_usage/{date} {
      // ユーザーは自分の利用回数データのみ読み取り可能
      allow read: if request.auth != null && request.auth.uid == userId;
      // 書き込みはサーバー側（Admin SDK）のみ許可
      allow write: if false;
    }

    // デフォルト: すべてのアクセスを拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

